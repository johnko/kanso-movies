<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />

    <title>Cloudbox</title>

    <link rel="stylesheet" type="text/css" href="./static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="./static/css/cloudbox.css" />
</head>

<body>

    <div id="header">
        <div id="player"></div>

        <h1>Cloudbox</h1>

        <div id="searchBox"></div>

        <div class="spacer"></div>
    </div>

    <div id="account"></div>

    <div id="list"></div>

    <div id="aboutLinkContainer">
        <a href="" id="aboutLink">About</a>
    </div>

    <div id="about" style="display:none">
        <a href="" id="aboutCloseLink">Close</a>

        <h1>This is Cloudbox 0.2</h1>

        <p>
            Copyright &copy; 2010 <a href="mailto:martin.kirch@gmail.com">Martin Kirchgessner</a>
            <br/>Copyright &copy; 2015 John Ko
        </p>

        <p>
            Cloudbox is a cloudy jukebox (hence the name).
            <br/>Originally written for CouchApp by Martin Kirchgessner, then ported to Kanso by John Ko, it is released under the
            <a href="http://opensource.org/licenses/MIT" target="_blank">MIT License</a> and powered by
            <a href="http://couchdb.apache.org/" target="_blank">CouchDB</a>,
            <a href="https://github.com/kanso/kanso" target="_blank">Kanso</a>,
            <a href="https://github.com/couchapp/couchapp" target="_blank">a CouchApp shim that includes the Evently + Mustache framework (couchapp.js)</a>,
            <a href="http://getbootstrap.com/" target="_blank">Bootstrap</a>,
            <a href="http://jquery.com/" target="_blank">jQuery</a>... and a whole lot of other open source projects.
        </p>

        <p>
            <a href="https://github.com/johnko/kanso-music" target="_blank">https://github.com/johnko/kanso-music</a>
        </p>
    </div>
    <!-- Placed at the end of the document so the pages load faster -->

    <!-- json2.js; add JSON if not exist; from https://github.com/douglascrockford/JSON-js -->
    <script src="./static/js/json2.js"></script>

    <!-- jquery -->
    <script src="./static/js/jquery-1.11.2.min.js"></script>

    <!-- bootstrap.min.js; requires jquery -->
    <script src="./static/js/bootstrap.min.js"></script>

    <!-- modules for require -->
    <script src="./modules.js"></script>

    <script>
        // in case the above don't load
        // redirect to _rewrite if we have no trailing slash
        if (window.location.href.match(/\/_rewrite$/) !== null) location.href += '/';

    </script>
    <script src="./vendor/couchapp/loader.js"></script>
    <script type="text/javascript" charset="utf-8">
        /*
        var splitUrl = document.location.href.split('/');
        var designPos = splitUrl.indexOf('_design');
        if (designPos > 4) {
            var newPrefix = "";
            for (var i = 3; i < (designPos - 1); i++) {
                newPrefix += "/" + splitUrl[i];
            }
            $.couch.urlPrefix = newPrefix;
        }
        */

        $.couch.urlPrefix = "./";
        $.couch.app(function(app) {
            var customAccount = $.extend(true, {}, app.ddoc.vendor.couchapp.evently.account, {
                loggedOut: app.ddoc.vendor.couchapp.evently.account.loginForm
            });

            $("#account").evently(customAccount);

            $("#player").evently("player", app);
            $.evently.connect("#account", "#player", ["loggedIn", "loggedOut"]);

            $("#list").evently("list", app);
            $.evently.connect("#account", "#list", ["loggedIn", "loggedOut"]);

            $.evently.connect("#list", "#player", ["play"]);
            $.evently.connect("#player", "#list", ["next", "previous"]);

            $("#searchBox").evently("searchBox", app);
            $.evently.connect("#account", "#searchBox", ["loggedIn", "loggedOut"]);
            $.evently.connect("#searchBox", "#list", ["setList"]);
        }, {
            db: "_db",
            design: "music"
        });

        $('#aboutLink').click(function(e) {
            $('#about').fadeIn();
            e.preventDefault();
        });

        $('#aboutCloseLink').click(function(e) {
            $('#about').fadeOut();
            e.preventDefault();
        });

    </script>
</body>

</html>
